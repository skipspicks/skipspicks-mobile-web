(function(){$("div").live("pagebeforeshow",function(){$('div[data-role="footer"]').html($("div#static-footer").html())});$("div#home").live("pagebeforeshow",function(){if(SP.readCookie("user-name")){if($('#homeLinks[data-inc!="add"]')){$('#homeLinks[data-inc!="add"]').append('<li id="homeListAdd"><a href="add.php?">Add Location</a></li>').listview("refresh");$("#homeLinks").attr("data-inc","add")}}else{$("#homeListAdd").remove();$("#homeLinks").attr("data-inc","")}});$("div#add").live("pageshow",function(){SP.setAddPage()});$("div#add").live("pagehide",function(){$("div#add").remove()});$("div#nearby").live("pageshow",function(){SP.getNearby()});$("div#nearby").live("pagehide",function(){});$("div#detail").live("pageshow",function(){var c=/id=(\d+)/;var a=c.exec(window.location.hash);var d=a[1];var c=/type=(\w+)/;var a=c.exec(window.location.hash);var b=(a&&a.length>0)?a[1]:null;SP.getDetail(d,b)});$("div#detail").live("pagehide",function(){});$("#favs").live("pageshow",function(){SP.getFavorites()});$("div#search-filter").live("pagehide",function(){$("div#search-filter").remove()});$("div#loc-dialog").live("pageshow",function(){$("#loc-form").submit(function(a){a.preventDefault();var b={};b.address=$('input:[name="address"]',$(this)).val();b.city=$('input:[name="city"]',$(this)).val();b.state=$('input:[name="state"]',$(this)).val();b.zip=$('input:[name="postal_code"]',$(this)).val();SP.loadGMapApi.callback=function(){SP.reverseGeoCode(b,function(c){if(c){var e=c.geometry.location;SP.log(e,3);var d={coords:{latitude:e.lat(),longitude:e.lng()}};SP.log(d,3);SP.createCookie("user-location",JSON.stringify(d),30);if(/#&/.test(window.location.hash)){window.location.href="/"}else{var f=window.location.hash.substr(1);$.mobile.changePage(f,"slide",true,false)}}})};SP.loadGMapApi.loadjsapi();return false})});$(document).ready(function(){})}());if(!this.SP){this.SP={}}(function(){var e=false;var a=2;var d;var b;var c={};SP={post:function(f,i,g,h){$.ajax({url:f,type:i||"GET",cache:false,data:g,success:function(j){SP.log("$ajax.success",3);h(j)},complete:function(k,j){if(j!="success"){SP.log("ajax status:"+j,3);SP.log(k,3)}}})},locationRestRequest:function(h,i){SP.log("locationRestRequest()",3);var g="/rest/v1/locations/";g+=(h.id)?h.id:"";g+="?qt="+((h.qt)?h.qt:"");g+="&sort="+((h.sort)?h.sort:"");g+="&details="+((h.details)?h.details:"");g+="&rating="+((h.rating)?h.rating:"");g+="&price="+((h.price)?h.price:"");g+="&lat="+((h.latitude)?h.latitude:"");g+="&lng="+((h.longitude)?h.longitude:"");SP.log(g,3);SP.post(g,"GET",null,function(f){var k=f.locations;for(var j=0;j<k.length;j++){SP.addLocationToDB(k[j])}i(k)})},preProcessSubmitForm:function(f){},preProcessAddForm:function(g){$("input:disabled").removeAttr("disabled");$("input:hidden").removeAttr("disabled");var f=g.attr("action");console.log(f);if($('input:[name="lat"]',g).val()==""){SP.log("retrieving lat lng",2);var h={};h.address=$('input:[name="address"]',g).val();h.city=$('input:[name="city"]',g).val();h.state=$('input:[name="state"]',g).val();SP.loadGMapApi.callback=function(){SP.reverseGeoCode(h,function(i){if(i){var j=i.geometry.location;SP.log(j,2);$('input:[name="lat"]',g).val(j.lat());$('input:[name="lng"]',g).val(j.lng());$.mobile.changePage({url:f,type:"POST",data:g.serialize()},"pop",false,false)}else{SP.log("reverting to device location",2);SP.withGeoLocation(function(l){if(l){var k=l.coords;$('input:[name="lat"]',g).val(k.latitude);$('input:[name="lng"]',g).val(k.longitude);$.mobile.changePage({url:f,type:"POST",data:g.serialize()},"pop",false,false)}})}})};SP.loadGMapApi.loadjsapi()}else{SP.log("adding location, no geo lookup",2);$.mobile.changePage({url:f,type:"POST",data:g.serialize()},"pop",false,false)}},setAddPage:function(){SP.log("calling setAddPage",3);if(typeof id!="undefined"&&/id=\d+/.test(window.location.hash)){SP.getLocationFromDB(id,function(i){for(var h in i){var g="#add"+h.charAt(0).toUpperCase()+h.slice(1);var f=$(g);if(f&&i[h]){f.val(i[h]);f.attr("disabled","disabled")}}$("div#add").page()})}$("#addUser").val(SP.readCookie("user-name"));$("#addUserId").val(SP.readCookie("user-id"))},getFavorites:function(){SP.log("getFavorites()",3);SP.getAllFavoritesFromDB(function(h){SP.log(h,3);var f=[];for(var g=0;g<h.length;g++){SP.getLocationFromDB(h[g].key,function(i){f.push(i)})}$("ul#favorites").html(tmpl("list_tmpl",f));$("ul#favorites").listview("refresh");$("#favorites").page()})},doSearch:function(f){SP.log("doSearch()",3);SP.log(f,3);SP.withGeoLocation(function(g){f.latitude=g.coords.latitude;f.longitude=g.coords.longitude;SP.locationRestRequest(f,function(h){$("ul#searchresults").html(tmpl("list_tmpl",h)).page();$("ul#searchresults").listview("refresh")})})},getUser:function(f,h,i,j){SP.log("getUser: "+f+"/"+h,3);var g="/rest/v1/users/"+f+"?password="+h;if(c.coords){g+="&lat="+c.coords.latitude+"&lng="+c.coords.longitude}if(!i){g+="&enc=false"}SP.log("url: "+g,3);SP.post(g,"GET",null,function(k){if(k&&k.status=="okay"){SP.createCookie("user-name",k.user_name,30);SP.createCookie("user-password",k.password,30);SP.createCookie("user-id",k.user_id,30);j(k)}else{alert("Please check your user name and password and try again.")}})},createUser:function(g,h){SP.log("createUser",3);var f="/rest/v1/users/"+g.user_name.value+"?password="+g.password.value+"&email="+g.email.value;SP.log(f,3);SP.post(f,"POST",null,function(i){if(i&&i.status=="okay"){SP.log("creating: ",3);SP.log(i);SP.createCookie("user-name",i.user_name,30);SP.createCookie("user-password",i.password,30);SP.createCookie("user-id",i.user_id,30);h(i)}else{alert("There was a problem adding the user; that username might already exist.")}})},logOut:function(f){SP.log("logOut()",3);SP.eraseCookie("user-name");SP.eraseCookie("user-password");SP.eraseCookie("user-id");f()},convertYahooLocationToSPLocation:function(f){var g={};g.yahoo_id=f.id;g.name=f.Title;g.address=f.Address;g.city=f.City;g.state=f.State;g.postal_code="";g.phone=f.Phone;g.lat=f.Latitude;g.lng=f.Longitude;g.url=f.BusinessClickUrl;g.avg_rev_rating=f.Rating.AverageRating;g.distance=f.Distance;g.reviews=[{body:f.Rating.LastReviewIntro}];g.type="yahoo";return g},initLocationDB:function(){if(d){return}SP.log("init locationDB",2);d=new Lawnchair({table:"location",adaptor:"dom"},function(f){SP.log("db init'd",2)})},addLocationToDB:function(f,g){SP.initLocationDB();f.key=(f.location_id)?f.location_id:f.yahoo_id;SP.log("adding loc "+f.key+" to db",3);SP.log(f,3);if(g){d.save(f,g)}else{d.save(f,function(h){})}},getLocationFromDB:function(f,g){SP.initLocationDB();SP.log("retrieving loc "+f+" from db",3);d.get(f,g)},removeLocationFromDB:function(f){SP.initLocationDB();SP.log("deleting loc "+f+" from db",3);d.remove(f)},initFavoriteDB:function(){if(b){return}SP.log("init favoriteDB",3);b=new Lawnchair({table:"favorites",adaptor:"dom"},function(f){SP.log("favorite db init'd",3)})},addFavoriteToDB:function(g,h){SP.initFavoriteDB();var f={key:g.key};SP.log("adding fav "+f.key+" to favorites db",3);SP.log(f,3);if(h){b.save(f,h)}else{b.save(f,function(i){})}},getAllFavoritesFromDB:function(f){SP.initFavoriteDB();SP.log("retrieving locs from favorite db",3);b.all(f)},getFavoriteFromDB:function(f,g){SP.initFavoriteDB();b.get(f,g)},removeFavoriteFromDB:function(f){SP.initFavoriteDB();SP.log("deleting fav "+f+" from db",2);b.remove(f)},geocode:function(f,i){var g=new google.maps.Geocoder();var h=new google.maps.LatLng(f.latitude,f.longitude);g.geocode({latLng:h},function(k,j){if(j==google.maps.GeocoderStatus.OK){if(k[0]){SP.log(k,3)}}else{alert("Geocoder failed due to: "+j)}})},reverseGeoCode:function(h,i){var g=new google.maps.Geocoder();var f=h.address+","+h.city+","+h.state+","+h.zip;f=f.replace(/\s/g,"+");console.log(f);g.geocode({address:f},function(k,j){if(j!=google.maps.GeocoderStatus.OK){SP.log("Geocode was not successful for the following reason: "+j,1)}i(k[0])})},withGeoLocation:function(i,h){try{var f=JSON.parse(SP.readCookie("user-location"))}catch(g){console.log(g)}if(f&&typeof(f)=="object"){SP.log("using cookie location",3);c=f}if(c.coords){SP.log("cached",3);if(h){h()}else{i(c)}return}if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(j){SP.log("new GEO!",3);c=j;i(c)},function(j){SP.log("geo locating threw the error ["+j.code+"] "+j.message,1);$.mobile.changePage("loc-dialog.html","pop",true,false)},{maximumAge:300000,timeout:5000,enableHighAccuracy:true})}else{if(typeof(Mojo)!="undefined"&&typeof(Mojo.Service.Request)!="Mojo.Service.Request"){r=new Mojo.Service.Request("palm://com.palm.location",{method:"getCurrentPosition",parameters:{accuracy:1,maximumAge:0,responseTime:1},onSuccess:function(j){i({timestamp:j.timestamp,coords:{latitude:j.latitude,longitude:j.longitude,heading:j.heading}})},onFailure:function(j){SP.log("error getting mojo geolocation: "+j,1)}})}else{SP.log("browser does not support geo positioning",2)}}},loadGMapApi:{callback:null,loadjsapi:function(){SP.log("loadjsapi()",2);SP.log("loading now",2);var f=document.createElement("script");f.src="http://www.google.com/jsapi?key="+SP.getGKey()+"&callback=SP.loadGMapApi.loadMapAPI";document.getElementsByTagName("head")[0].appendChild(f);e=true},loadMapAPI:function(){console.log("loaded!");google.load("maps","3",{other_params:"sensor=true",callback:this.callback})}},getGKey:function(){var f="ABQIAAAAuRZkfXnOvWgSRQYXsrsfjBQBSCnPmKbx2s6PCP8pRShTn_b5OBQXc1NFLmbXp9uuJFBJ5l8y3HzFMA";var g="ABQIAAAAuRZkfXnOvWgSRQYXsrsfjBSKPUBGkfe_1QsR14S-5yUtlhJh1RSGSOd1TAIgZapEt_u6-U74FEgKJA";if(/skipspicks.com/.test(window.location.hostname)){return g}return f},postTwitterStatus:function(f){var g="/php/rest.php?api=twitter&status="+f;SP.post(g,"GET",null,null)},loadScript:function(i,f){var h=document.getElementsByTagName("head")[0];var g=document.createElement("script");g.src=i;g.onload=f;g.onreadystatechange=function(){if(this.readyState=="complete"){f()}};h.appendChild(g)},createCookie:function(h,i,j){if(j){var g=new Date();g.setTime(g.getTime()+(j*24*60*60*1000));var f="; expires="+g.toGMTString()}else{var f=""}document.cookie=h+"="+i+f+"; path=/"},readCookie:function(g){var j=g+"=";var f=document.cookie.split(";");for(var h=0;h<f.length;h++){var k=f[h];while(k.charAt(0)==" "){k=k.substring(1,k.length)}if(k.indexOf(j)==0){return k.substring(j.length,k.length)}}return null},eraseCookie:function(f){SP.createCookie(f,"",-1)},log:function(f,g){if(g<=a){console.log(f)}},getUrlParams:function(){var g={};var j,f=/\+/g,h=/([^&;=]+)=?([^&;]*)/g,k=function(l){return decodeURIComponent(l.replace(f," "))},i=(window.location.search)?window.location.search.substring(1):window.location.hash.split("?")[1];while(j=h.exec(i)){g[k(j[1])]=k(j[2])}return g},p:function(f){return(f)?f:""},getDetail:function(g,f){SP.log("id: "+g+"; type: "+f,2);SP.log("getDetail("+g+")",3);if(f=="yahoo"){SP.getLocationFromDB(g,function(h){SP.locationRestRequest({qt:escape(h.name)},function(i){if(i.length>0){SP.log("found a match, rendering!",3);i[0].display_id=g;SP.renderDetail(i[0])}else{SP.log("no match, grab from yahoo and render",3);SP.getYahooLocal(null,{id:g},"SP.getSingleYahooForRender")}})})}else{SP.locationRestRequest({id:g},function(h){SP.log("checking for existing: "+g,3);if(h.length>0){h[0].display_id=g;SP.renderDetail(h[0])}else{SP.renderDetail({key:g})}})}},getSingleYahooForRender:function(h){SP.log("getSingleYahooForRender()",3);SP.log(h,3);var g=h.ResultSet.Result;var f=SP.convertYahooLocationToSPLocation(g);f.display_id=f.yahoo_id;SP.addLocationToDB(f);SP.renderDetail(f)},renderDetail:function(f){SP.log("rendering detail object: "+f.key,3);SP.log(f,3);$("#details-"+f.display_id).html(tmpl("detail_tmpl",f)).page();$("h2#detailLocName-"+f.display_id).text(f.name);SP.getFavoriteFromDB(f.key,function(i){var g=$("#favorite-"+f.key);var h=$("#favbutton-"+f.key);if(i){g.attr("data-icon","delete");g.text("Remove from Favorites").button();g.bind("click",function(){SP.removeFavoriteFromDB(f.key);h.remove()})}else{g.button();g.bind("click",function(){SP.addFavoriteToDB(f);h.remove()})}});$("#details-"+f.display_id).page().page("destroy")},renderNearby:function(l){SP.log("original yahoo object:",3);SP.log(l,3);var f=[];var h=l.ResultSet.Result;for(var j=0;j<h.length;j++){var k=h[j];var g=SP.convertYahooLocationToSPLocation(k);SP.addLocationToDB(g);f.push(g)}$("ul#nearbys").html(tmpl("list_tmpl",f));$("ul#nearbys").listview("refresh");$.mobile.pageLoading(true)},getNearby:function(){SP.log("renderNearby()",3);$.mobile.pageLoading();SP.withGeoLocation(function(f){SP.log(f,3);SP.getYahooLocal(f,null,"SP.renderNearby")})},getYahooLocal:function(k,h,j){var f="http://local.yahooapis.com/LocalSearchService/V3/localSearch";var g="hK.bnA7V34EQYsQLfVbdFoAgAkItOiaQ.pSUBVClWeLuB..rD8P.85pliVIZeg--";f+="?appid="+g+"&results=15&radius=3.5&sort=distance&output=json";if(k){var i=k.coords;f+="&latitude="+i.latitude+"&longitude="+i.longitude}f+="&query=restaurant";if(h){if(h.qt){f+="+"+escape(h.qt)}if(h.id){f+="&listing_id="+h.id}}f+="&callback="+j;SP.log(f,3);SP.loadScript(f,null)}}}());var Lawnchair=function(b,a){if(typeof a=="undefined"){throw"Please provide a callback as second parameter to Lawnchair constructor; this shit's async, yo."}if(!JSON||!JSON.stringify){throw"Native JSON functions unavailable - please include http://www.json.org/json2.js or run on a decent browser :P"}this.init(b);a.call(this)};Lawnchair.prototype={init:function(b){var a={webkit:window.WebkitSQLiteAdaptor,gears:window.GearsSQLiteAdaptor,dom:window.DOMStorageAdaptor,cookie:window.CookieAdaptor,air:window.AIRSQLiteAdaptor,userdata:window.UserDataAdaptor,"air-async":window.AIRSQLiteAsyncAdaptor,blackberry:window.BlackBerryPersistentStorageAdaptor,couch:window.CouchAdaptor,server:window.ServerAdaptor};this.adaptor=b.adaptor?new a[b.adaptor](b):new DOMStorageAdaptor(b)},save:function(a,b){this.adaptor.save(a,b)},get:function(a,b){this.adaptor.get(a,b)},exists:function(a){this.adaptor.exists(a)},all:function(a){this.adaptor.all(a)},remove:function(b,a){this.adaptor.remove(b,a)},nuke:function(a){this.adaptor.nuke(a);return this},paged:function(a,b){this.adaptor.paged(a,b)},find:function(condition,callback){var is=(typeof condition=="string")?function(r){return eval(condition)}:condition,cb=this.adaptor.terseToVerboseCallback(callback);this.each(function(record,index){if(is(record)){cb(record,index)}})},each:function(b){var a=this.adaptor.terseToVerboseCallback(b);this.all(function(e){var c=e.length;for(var d=0;d<c;d++){a(e[d],d)}})}};var LawnchairAdaptorHelpers={merge:function(a,b){return(b==undefined||b==null)?a:b},terseToVerboseCallback:function(callback){return(typeof arguments[0]=="string")?function(r,i){eval(callback)}:callback},now:function(){return new Date().getTime()},uuid:function(a,d){var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var c=[];d=d||f.length;if(a){for(var b=0;b<a;b++){c[b]=f[0|Math.random()*d]}}else{var e;c[8]=c[13]=c[18]=c[23]="-";c[14]="4";for(var b=0;b<36;b++){if(!c[b]){e=0|Math.random()*16;c[b]=f[(b==19)?(e&3)|8:e]}}}return c.join("")},serialize:function(b){var a="";a=JSON.stringify(b);return a},deserialize:function(json){return eval("("+json+")")}};var WebkitSQLiteAdaptor=function(a){for(var b in LawnchairAdaptorHelpers){this[b]=LawnchairAdaptorHelpers[b]}this.init(a)};WebkitSQLiteAdaptor.prototype={init:function(a){var c=this;var d=c.merge;var b=(typeof arguments[0]=="string")?{table:a}:a;this.name=d("Lawnchair",b.name);this.version=d("1.0",b.version);this.table=d("field",b.table);this.display=d("shed",b.display);this.max=d(65536,b.max);this.db=d(null,b.db);this.perPage=d(10,b.perPage);this.onError=function(){};this.onData=function(){};if("onError" in b){this.onError=b.onError}if(typeof b.callback!=="function"){b.callback=function(){}}if(!window.openDatabase){throw ('Lawnchair, "This browser does not support sqlite storage."')}if(!WebkitSQLiteAdaptor.globaldb){WebkitSQLiteAdaptor.globaldb=openDatabase(this.name,this.version,this.display,this.max)}this.db=WebkitSQLiteAdaptor.globaldb;c.db.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS "+c.table+" (id NVARCHAR(32) UNIQUE PRIMARY KEY, value TEXT, timestamp REAL)",[],b.callback,c.onError)})},save:function(c,e){var a=this;var d=function(h,f,g){a.db.transaction(function(i){i.executeSql("UPDATE "+a.table+" SET value=?, timestamp=? WHERE id=?",[a.serialize(f),a.now(),h],function(){if(g!=undefined){f.key=h;a.terseToVerboseCallback(g)(f)}},a.onError)})};var b=function(f,g){a.db.transaction(function(h){var i=(f.key==undefined)?a.uuid():f.key;delete (f.key);h.executeSql("INSERT INTO "+a.table+" (id, value,timestamp) VALUES (?,?,?)",[i,a.serialize(f),a.now()],function(){if(g!=undefined){f.key=i;a.terseToVerboseCallback(g)(f)}},a.onError)})};if(c.key==undefined){b(c,e)}else{this.get(c.key,function(f){var g=(f!=null);if(g){var h=c.key;delete (c.key);d(h,c,e)}else{b(c,e)}})}},get:function(a,c){var b=this;this.db.transaction(function(d){d.executeSql("SELECT value FROM "+b.table+" WHERE id = ?",[a],function(e,f){if(f.rows.length==0){b.terseToVerboseCallback(c)(null)}else{var g=b.deserialize(f.rows.item(0).value);g.key=a;b.terseToVerboseCallback(c)(g)}},this.onError)})},all:function(c){var a=this.terseToVerboseCallback(c);var b=this;this.db.transaction(function(d){d.executeSql("SELECT * FROM "+b.table,[],function(f,j){if(j.rows.length==0){a([])}else{var k=[];for(var h=0,e=j.rows.length;h<e;h++){var g=j.rows.item(h).value;var m=b.deserialize(g);m.key=j.rows.item(h).id;k.push(m)}a(k)}},b.onError)})},paged:function(c,d){var a=this.terseToVerboseCallback(d);var b=this;this.db.transaction(function(e){var g=b.perPage*(c-1);var f="SELECT * FROM "+b.table+" ORDER BY timestamp ASC LIMIT ? OFFSET ?";e.executeSql(f,[b.perPage,g],function(j,n){if(n.rows.length==0){a([])}else{var o=[];for(var m=0,h=n.rows.length;m<h;m++){var k=n.rows.item(m).value;var p=b.deserialize(k);p.key=n.rows.item(m).id;o.push(p)}a(o)}},b.onError)})},remove:function(c,b){var a=this;if(b){b=a.terseToVerboseCallback(b)}this.db.transaction(function(d){d.executeSql("DELETE FROM "+a.table+" WHERE id = ?",[(typeof c=="string")?c:c.key],b||a.onData,a.onError)})},nuke:function(b){var a=this;if(b){b=a.terseToVerboseCallback(b)}this.db.transaction(function(c){c.executeSql("DELETE FROM "+a.table,[],b||a.onData,a.onError)})}};var DOMStorageAdaptor=function(a){for(var b in LawnchairAdaptorHelpers){this[b]=LawnchairAdaptorHelpers[b]}this.init(a)};DOMStorageAdaptor.prototype={init:function(b){var a=this;this.storage=this.merge(window.localStorage,b.storage);this.table=this.merge("field",b.table);if(!window.Storage){this.storage=(function(){var c=window.top.name?a.deserialize(window.top.name):{};return{setItem:function(d,e){c[d]=e+"";window.top.name=a.serialize(c)},removeItem:function(d){delete c[d];window.top.name=a.serialize(c)},getItem:function(d){return c[d]||null},clear:function(){c={};window.top.name=""}}})()}},save:function(a,c){var b=this.table+"::"+(a.key||this.uuid());delete a.key;this.storage.setItem(b,this.serialize(a));if(c){a.key=b.split("::")[1];this.terseToVerboseCallback(c)(a)}},get:function(b,d){var c=this.deserialize(this.storage.getItem(this.table+"::"+b)),a=this.terseToVerboseCallback(d);if(c){c.key=b;if(d){a(c)}}else{if(d){a(null)}}},all:function(j){var c=this.terseToVerboseCallback(j);var f=[];for(var g=0,b=this.storage.length;g<b;++g){var a=this.storage.key(g);var e=a.split("::")[0];var h=a.split("::").slice(1).join("::");if(e==this.table){var d=this.deserialize(this.storage.getItem(a));d.key=h;f.push(d)}}if(c){c(f)}},remove:function(c,b){var a=this.table+"::"+(typeof c==="string"?c:c.key);this.storage.removeItem(a);if(b){this.terseToVerboseCallback(b)()}},nuke:function(b){var a=this;this.all(function(e){for(var d=0,c=e.length;d<c;d++){a.remove(e[d])}if(b){a.terseToVerboseCallback(b)()}})}};var CookieAdaptor=function(a){for(var b in LawnchairAdaptorHelpers){this[b]=LawnchairAdaptorHelpers[b]}this.init(a)};CookieAdaptor.prototype={init:function(){this.createCookie=function(c,d,e){if(e){var b=new Date();b.setTime(b.getTime()+(e*24*60*60*1000));var a="; expires="+b.toGMTString()}else{var a=""}document.cookie=c+"="+d+a+"; path=/"}},get:function(a,d){var c=function(g){var j=g+"=";var f=document.cookie.split(";");var e=f.length;for(var h=0;h<e;h++){var k=f[h];while(k.charAt(0)==" "){k=k.substring(1,k.length)}if(k.indexOf(j)==0){return k.substring(j.length,k.length)}}return null};var b=this.deserialize(c(a))||null;if(b){b.key=a}if(d){this.terseToVerboseCallback(d)(b)}},save:function(a,c){var b=a.key||this.uuid();delete a.key;this.createCookie(b,this.serialize(a),365);a.key=b;if(c){this.terseToVerboseCallback(c)(a)}},all:function(n){var d=this.terseToVerboseCallback(n);var f=document.cookie.split(";");var h=[];var j,e,m,a;for(var g=0,b=f.length;g<b;g++){j=f[g].split("=");e=j[0];m=j[1];a=this.deserialize(m);if(a){a.key=e;h.push(a)}}if(d){d(h)}},remove:function(c,b){var a=(typeof c=="string")?c:c.key;this.createCookie(a,"",-1);if(b){this.terseToVerboseCallback(b)()}},nuke:function(b){var a=this;this.all(function(e){for(var d=0,c=e.length;d<c;d++){if(e[d].key){a.remove(e[d].key)}}if(b){b=a.terseToVerboseCallback(b);b(e)}})}};(function(){var b={};this.tmpl=function a(e,d){var c=!/\W/.test(e)?b[e]=b[e]||a(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"\t").split("'").join("\\'").split("\t").join("'").replace(/<%=(.+?)%>/g,"',$1,'").split("<%").join("');").split("%>").join("p.push('")+"');}return p.join('');");return d?c(d):c}})();var JSON;if(!JSON){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());